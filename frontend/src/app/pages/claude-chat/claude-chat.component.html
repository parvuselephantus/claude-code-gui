<div class="claude-chat-container">
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-left">
      <h1>Claude Code GUI</h1>
      <div class="status-info" *ngIf="statusChecked">
        <mat-chip [color]="claudeAvailable ? 'primary' : 'warn'" class="status-chip">
          {{ claudeAvailable ? 'â— Available' : 'â— Not Available' }}
        </mat-chip>
        <mat-chip class="mode-chip">
          {{ useMcpMode ? 'ğŸ’¬ MCP Mode' : 'ğŸ“„ Simple Mode' }}
        </mat-chip>
      </div>
    </div>
    <button mat-icon-button (click)="goToSettings()" class="settings-button" matTooltip="Settings">
      <mat-icon>settings</mat-icon>
    </button>
  </div>

  <!-- Warning if Claude not available -->
  <mat-card class="warning-card" *ngIf="statusChecked && !claudeAvailable">
    <mat-card-content>
      âš ï¸ Claude Code CLI is not installed or not in PATH
    </mat-card-content>
  </mat-card>

  <!-- Input Card -->
  <mat-card class="input-card">
    <mat-card-header>
      <mat-card-title>Ask Claude</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <!-- Prompt Input -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Prompt</mat-label>
        <textarea
          matInput
          [(ngModel)]="prompt"
          [disabled]="isAnalyzing"
          rows="6"
          placeholder="Ask Claude anything..."
          (keydown.control.enter)="analyze()"
        ></textarea>
        <mat-hint>Press Ctrl+Enter to submit</mat-hint>
      </mat-form-field>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button
          mat-raised-button
          color="primary"
          (click)="analyze()"
          [disabled]="isAnalyzing || !prompt.trim() || !claudeAvailable"
        >
          <mat-spinner *ngIf="isAnalyzing" diameter="20"></mat-spinner>
          <span *ngIf="!isAnalyzing">Send</span>
          <span *ngIf="isAnalyzing">Analyzing...</span>
        </button>

        <button
          mat-stroked-button
          (click)="clearResults()"
          [disabled]="isAnalyzing || conversationHistory.length === 0"
        >
          New Conversation
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Conversation History Card -->
  <mat-card class="conversation-card" *ngIf="conversationHistory.length > 0">
    <mat-card-header>
      <mat-card-title>
        ğŸ’¬ Conversation
      </mat-card-title>
      <div class="conversation-metadata">
        <mat-chip *ngIf="conversationId" color="primary">ID: {{ conversationId.substring(0, 8) }}</mat-chip>
        <mat-chip>{{ conversationHistory.length }} messages</mat-chip>
        <mat-chip *ngIf="!isAnalyzing && durationMs > 0">â±ï¸ {{ durationMs / 1000 | number:'1.1-1' }}s</mat-chip>
      </div>
    </mat-card-header>
    <mat-card-content>
      <div class="conversation-history">
        <div *ngFor="let message of reversedConversationHistory"
             class="message-block"
             [class.user-message]="message.role === 'user'"
             [class.assistant-message]="message.role === 'assistant'">

          <!-- Message Header -->
          <div class="message-header">
            <div class="message-role">
              <strong>{{ message.role === 'user' ? 'ğŸ‘¤ You' : 'ğŸ¤– Claude' }}</strong>
            </div>
            <span class="message-timestamp">{{ message.timestamp | date:'short' }}</span>
          </div>

          <!-- Message Content -->
          <div class="message-content">
            <pre class="message-text">{{ message.content }}</pre>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Error Card -->
  <mat-card class="error-card" *ngIf="error">
    <mat-card-header>
      <mat-card-title>âŒ Error</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="error-display">
        <p>{{ error }}</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
